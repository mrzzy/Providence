#
# Providence
# Transforms
# DBT Analytics Models
#

version: 2
models:
  - name: dim_date
    description: Provides descriptive attributes for dates.
    columns:
      - name: id
        description: Surrogate key for the date.
        tests:
          - unique
          - not_null
      - name: date
        tests:
          - not_null
      - name: day_of_month
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 31
      - name: month_of_year
        description: Numeric month of the year.
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 12
      - name: month_name
        description: Long name  of the month.
        tests:
          - not_null
      - name: month_short
        description: "3 character abbreviation of the name of the month."
        tests:
          - not_null
      - name: year
        tests:
          - not_null
      - name: day_of_week
        description: Numeric day of the week (Sunday is 0).
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 6
      - name: weekday_name
        description: Name of the weekday.
        tests:
          - not_null
      - name: weekday_short
        description: "3 character abbreviation of the name of the weekday."
      - name: day_of_year
        description: Numeric day of the year
        test:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 366
      - name: week_of_month,
        description: Week no. of the month,
        test:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
      - name: week_of_year
        description: Week no. of the year.
        test:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 52
      - name: quarter
        description: Quarter no. of the year.
        test:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 52
      - name: year_month
        test:
          - not_null

  - name: dim_bank_card
    description: Bank card used to pay for public transport trips.
    columns:
      - name: id
        description: Key for the bank card.
        tests:
          - not_null
          - unique
      - name: name
        description: User assigned name of the bank card.
        tests:
          - not_null
      - name: updated_at
        description: Timestamp when the data was last updated / refreshed.
        tests:
          - not_null

  - name: fact_public_transport_trip_leg
    description: Legs of a Public Transport Trip.
    columns:
      - name: id
        description: Surrogate key for the Trip leg.
      - name: posting_ref
        description: Posting / billing reference assigned once the Trip Leg is billed.
      - name: traveled_on
        description: Timestamp when the Trip Leg was made.
        tests:
          - not_null
      - name: travel_date_id
        description: Date on which the Trip Leg was made.
        tests:
          - not_null
      - name: cost_sgd
        description: Cost of the Trip Leg in SGD.
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
      - name: source
        description: Start location of the Trip Leg.
        tests:
          - not_null
      - name: destination
        description: End location of the Trip Leg.
        tests:
          - not_null
      - name: transport_mode
        description: Mode of public transport used for this Trip Leg.
        tests:
          - not_null
          - accepted_values:
              values:
              - Rail
              - Bus
      - name: bank_card_id
        description: ID of the Bank Card used to pay for this Trip Leg.
        tests:
          - not_null
          - relationships:
              to: ref("dim_bank_card")
              field: id
      - name: updated_at
        description: Timestamp when the data was last updated / refreshed.
        tests:
          - not_null
